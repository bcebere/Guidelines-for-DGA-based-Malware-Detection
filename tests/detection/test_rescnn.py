# third party
import pytest

# dga_analysis absolute
from dga_analysis.datasets.dataset_mixed import DatasetMixed

# tls_fingerprinting absolute
from dga_analysis.detection.rescnn import ResCNNClassifier as plugin
from dga_analysis.utils.evaluation import evaluate_classifier


def test_rescnn_plugin_sanity() -> None:
    test_plugin = plugin()
    assert test_plugin is not None


@pytest.mark.parametrize("multiclass", [False, True])
def test_rescnn_plugin_fit(multiclass: bool) -> None:
    test_plugin = plugin(
        n_units_emb=51,
        n_iter=2,
    )
    dataset = DatasetMixed(sample_size=5000, multiclass=multiclass)
    X, y = dataset.raw_np()

    test_plugin.fit(X, y)


@pytest.mark.parametrize("multiclass", [True, False])
def test_rescnn_plugin_fit_predict_dga(multiclass: bool) -> None:
    test_plugin = plugin(
        n_units_emb=50,
        n_iter=10,
    )
    dataset = DatasetMixed(sample_size=5000, multiclass=multiclass)
    X, y = dataset.raw_np()

    scores = evaluate_classifier(test_plugin, X, y)
    print(scores["str"])
